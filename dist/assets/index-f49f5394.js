import{h as M,K as O,r as P,z,p as a,l as _,W as L,B as f,C as u,q as p,k as m,ar as R,N as b,Q as h,R as A,S as v,t as g,Y as Q,M as C,o as E,U as T,T as K,E as W,aj as Y}from"./vue-a98ef309.js";import{F as $}from"./index-03bd2479.js";import{A as H,i as J,p as X,d as Z,a as ee}from"./add-bbced577.js";import{r as te}from"./router-fdeb3e3b.js";import{b as oe}from"./validate-594baa03.js";import{b as ne,A as ae,c as S,_ as re}from"./index-0c819fdc.js";import"./index-6f00a71d.js";import"./controllerUrls-beb409f8.js";import"./baAccount-2dad18d3.js";import"./IRequests-783be2cd.js";const le={class:"default-main"},ie={class:"config-form-item"},se={class:"config-form-item-name"},de={class:"del-config-form-item"},ue={key:0,class:"send-test-mail"},ce=["onClick"],fe=M({name:"routine/config"}),pe=M({...fe,setup(me){const{t:s}=ne(),B=ae(),y=O(),e=P({loading:!0,config:[],remark:"",configGroup:{},activeTab:"",showAddForm:!1,rules:{},form:{},quickEntrance:{},formKey:S()}),F=()=>{J().then(i=>{e.config=i.data.list,e.remark=i.data.remark,e.configGroup=i.data.configGroup,e.quickEntrance=i.data.quickEntrance,e.loading=!1;for(const n in e.configGroup){e.activeTab=n;break}let o={},r={};for(const n in e.config)for(const l in e.config[n].list){if(e.config[n].list[l].rule){let V=e.config[n].list[l].rule.split(","),x=[];V.forEach(w=>{x.push(oe({name:w,title:e.config[n].list[l].title}))}),r=Object.assign(r,{[e.config[n].list[l].name]:x})}o[e.config[n].list[l].name]=e.config[n].list[l].type=="number"?parseFloat(e.config[n].list[l].value):e.config[n].list[l].value}e.form=o,e.rules=r,e.formKey=S()}).catch(()=>{e.loading=!1})},D=i=>{if(i=="add_config")return e.showAddForm=!0,!1},k=i=>{i&&i.validate(o=>{if(o){const r={};for(const n in e.config)if(n==e.activeTab)for(const l in e.config[n].list)r[e.config[n].list[l].name]=e.form[e.config[n].list[l].name]??"";X("edit",r).then(()=>{for(const n in B.$state)r[n]&&B.$state[n]!=r[n]&&(B.$state[n]=r[n])})}})},I=i=>{Z([i.id]).then(()=>{F()})},N=()=>{if(!e.form.smtp_server||!e.form.smtp_port||!e.form.smtp_user||!e.form.smtp_pass||!e.form.smtp_sender_mail)return W({type:"error",message:s("routine.config.Please enter the correct mail configuration")}),!1;Y.prompt(s("routine.config.Please enter the recipient email address"),s("routine.config.Test mail sending"),{confirmButtonText:s("routine.config.send out"),cancelButtonText:s("Cancel"),inputPattern:/[\w!#$%&'*+/=?^_`{|}~-]+(?:\.[\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/,inputErrorMessage:s("routine.config.Please enter the correct email address"),beforeClose:(i,o,r)=>{i==="confirm"?(o.confirmButtonLoading=!0,o.confirmButtonText=s("routine.config.Sending"),ee(e.form,o.inputValue).then(n=>{r()}).catch(n=>{r()})):r()}})};return z(()=>{F()}),(i,o)=>{const r=g("Icon"),n=g("el-popconfirm"),l=g("el-button"),V=g("el-tab-pane"),x=g("el-tabs"),w=g("el-col"),j=g("el-card"),q=g("el-row"),G=Q("loading");return a(),_("div",le,[L((a(),f(q,{gutter:20},{default:u(()=>[p(w,{class:"xs-mb-20",xs:24,sm:16},{default:u(()=>[e.loading?v("",!0):(a(),f(m(R),{ref_key:"formRef",ref:y,onKeyup:o[7]||(o[7]=b(d=>k(y.value),["enter"])),model:e.form,rules:e.rules,"label-position":"top",key:e.formKey},{default:u(()=>[p(x,{modelValue:e.activeTab,"onUpdate:modelValue":o[6]||(o[6]=d=>e.activeTab=d),type:"border-card","before-leave":D},{default:u(()=>[(a(!0),_(h,null,A(e.config,(d,U)=>(a(),f(V,{class:"config-tab-pane",key:U,name:U,label:d.title},{default:u(()=>[(a(!0),_(h,null,A(d.list,(t,ge)=>(a(),_("div",ie,[t.group==e.activeTab?(a(),_(h,{key:0},[t.type=="number"?(a(),f($,{label:t.title,type:t.type,modelValue:e.form[t.name],"onUpdate:modelValue":c=>e.form[t.name]=c,modelModifiers:{number:!0},"input-attr":{placeholder:t.tip},data:{tip:t.tip},attr:Object.assign({prop:t.name},t.extend),key:"number-"+t.id},null,8,["label","type","modelValue","onUpdate:modelValue","input-attr","data","attr"])):t.type=="editor"?(a(),f($,{label:t.title,type:t.type,onKeyup:[o[0]||(o[0]=b(C(()=>{},["stop"]),["enter"])),o[1]||(o[1]=b(C(c=>k(y.value),["ctrl"]),["enter"]))],modelValue:e.form[t.name],"onUpdate:modelValue":c=>e.form[t.name]=c,"input-attr":{placeholder:t.tip,style:{zIndex:99}},data:{tip:t.tip},attr:Object.assign({prop:t.name},t.extend),key:"editor-"+t.id},null,8,["label","type","modelValue","onUpdate:modelValue","input-attr","data","attr"])):t.type=="textarea"?(a(),f($,{label:t.title,type:t.type,onKeyup:[o[2]||(o[2]=b(C(()=>{},["stop"]),["enter"])),o[3]||(o[3]=b(C(c=>k(y.value),["ctrl"]),["enter"]))],modelValue:e.form[t.name],"onUpdate:modelValue":c=>e.form[t.name]=c,"input-attr":{placeholder:t.tip,rows:3},data:{tip:t.tip},attr:Object.assign({prop:t.name},t.extend),key:"textarea-"+t.id},null,8,["label","type","modelValue","onUpdate:modelValue","input-attr","data","attr"])):(a(),f($,{label:t.title,type:t.type,modelValue:e.form[t.name],"onUpdate:modelValue":c=>e.form[t.name]=c,"input-attr":{placeholder:t.tip},data:{tip:t.tip,content:t.content?t.content:{}},attr:Object.assign({prop:t.name},t.extend),key:"other-"+t.id},null,8,["label","type","modelValue","onUpdate:modelValue","input-attr","data","attr"])),E("div",se,"$"+T(t.name),1),E("div",de,[t.allow_del?(a(),f(n,{key:0,onConfirm:c=>I(t),confirmButtonText:m(s)("delete"),title:m(s)("routine.config.Are you sure to delete the configuration item?")},{reference:u(()=>[p(r,{class:"close-icon",size:"15",name:"el-icon-Close"})]),_:2},1032,["onConfirm","confirmButtonText","title"])):v("",!0)])],64)):v("",!0)]))),256)),d.name=="mail"?(a(),_("div",ue,[p(l,{onClick:o[4]||(o[4]=t=>N())},{default:u(()=>[K(T(m(s)("routine.config.Test mail sending")),1)]),_:1})])):v("",!0),p(l,{type:"primary",onClick:o[5]||(o[5]=t=>k(y.value))},{default:u(()=>[K(T(m(s)("Save")),1)]),_:1})]),_:2},1032,["name","label"]))),128)),p(V,{name:"add_config",class:"config-tab-pane config-tab-pane-add",label:m(s)("routine.config.Add configuration item")},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["model","rules"]))]),_:1}),p(w,{xs:24,sm:8},{default:u(()=>[p(j,{header:m(s)("routine.config.Quick configuration entry")},{default:u(()=>[(a(!0),_(h,null,A(e.quickEntrance,d=>(a(),f(l,{class:"config_quick_entrance"},{default:u(()=>[E("div",{onClick:U=>m(te)(d.value)},T(d.key),9,ce)]),_:2},1024))),256))]),_:1},8,["header"])]),_:1})]),_:1})),[[G,e.loading]]),e.loading?v("",!0):(a(),f(H,{key:0,modelValue:e.showAddForm,"onUpdate:modelValue":o[8]||(o[8]=d=>e.showAddForm=d),"config-group":e.configGroup},null,8,["modelValue","config-group"]))])}}});const Te=re(pe,[["__scopeId","data-v-529864f6"]]);export{Te as default};
